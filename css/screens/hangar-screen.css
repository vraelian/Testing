/* css/screens/hangar-screen.css */

/* ================================================================================
CORE THEME & VARIABLE SETUP
================================================================================
*/
:root {
    /* Base Colors */
    --ot-bg-dark: #0c101d;
    --ot-border-light: #4a6a8a;
    --ot-text-primary: #d0d8e8;
    --ot-text-secondary: #9ca3af;
    --ot-green-accent: #16a34a;
    --ot-red-accent: #f87171;
    --ot-cyan-base: #22d3ee;
    --ot-cyan-glow: #67e8f9;

    /* Toggle & Mode-Specific Colors */
    --ot-hangar-red-base: #ef4444;
    --ot-hangar-red-glow: #f87171;
    --ot-shipyard-blue-base: #60a5fa;
    --ot-shipyard-blue-glow: #93c5fd;

    /* Ship Class Colors */
    --class-s-color: #facc15; /* Gold */
    --class-a-color: #60a5fa; /* Blue */
    --class-b-color: #4ade80; /* Green */
    --class-c-color: #e5e7eb; /* White/Light Grey */
    --class-o-color: #fb923c; /* Orange (Capital) */
    --class-z-color: #ef4444; /* Red (Alien) */
    --class-f-color: #9ca3af; /* Grey (Flotsam) */
    
    /* Placeholder Theme */
    --theme-color-primary: #fde047;
    --theme-color-glow: #fef08a;
    --theme-bg-gradient: linear-gradient(145deg, rgba(113, 63, 18, 0.5), rgba(49, 46, 129, 0.8));

    /* Dynamic Frame Border Color */
    --frame-border-color: var(--ot-shipyard-blue-base);
}

/* Set Hangar-specific frame color when the .mode-hangar class is active */
#ship-terminal-container.mode-hangar {
    --frame-border-color: var(--ot-hangar-red-base);
}


/* ================================================================================
COMPONENT-SPECIFIC STYLING
================================================================================
*/

#ship-terminal-container {
    margin-top: -0.9625rem;
}

/* Carousel: Main container for ship cards */
.carousel-container { 
    width: 100%;
    position: relative;
    cursor: grab;
    flex-grow: 1;
    display: flex;
    overflow: hidden;
    /* Optimization: Isolate layout containment */
    contain: content; 
}
.carousel-container:active {
    cursor: grabbing;
}

#hangar-carousel {
    display: flex;
    height: 100%;
    width: 100%;
    transition: transform 0.4s ease-out;
    
    /* OPTIMIZATION: Standard hardware acceleration */
    will-change: transform;
    /* iOS Fix: Prevent flickering during drag */
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
}

.carousel-page {
    width: 100%;
    flex-shrink: 0;
    display: flex; 
    flex-direction: column; 
    user-select: none;
    padding-bottom: 4.0rem;
    
    /* VIRTUAL WORKBENCH: CRITICAL PERFORMANCE FIX (Virtualization-Lite) */
    /* UPDATED (1/11/26): Aggressive optimization restored; SVG Atom is immune to culling */
    contain: paint layout style; 
    content-visibility: auto; 
}

/* Backgrounds & Theming */
#ship-terminal {
    /* Default (Shipyard) Background */
    background-image: var(--theme-bg-gradient);
    
    display: flex; 
    flex-direction: column; 
    flex-grow: 1;
    height: auto;
    position: relative;
    z-index: 0;
}

/* Hangar Mode Background (Baked) */
#ship-terminal-container.mode-hangar #ship-terminal {
    /* Stacked gradient to simulate overlay blend mode cheaply */
    background-image: 
        linear-gradient(to bottom, rgba(26, 25, 61, 0.85), rgba(26, 25, 61, 0.7)), 
        var(--theme-bg-gradient);
    
    background-color: #1a193d;
}

/* The grid texture overlay */
#ship-terminal-container.mode-hangar #ship-terminal::after { 
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image:
        radial-gradient(circle at 10px 10px, rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 20px 20px;
    pointer-events: none;
    z-index: -1;
}

/* Glow Pseudo-Element (Dematerialize Effect) */
#ship-terminal::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: -2;
    border-radius: 0.5rem;
    
    background: radial-gradient(circle, var(--frame-border-color) 30%, transparent 70%);
    
    opacity: 0;
    pointer-events: none;
    
    transform-origin: center;
    transform: scale(0.5);
}

/* Generic Opacity Pulse */
@keyframes pulse-opacity {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1.0; }
}

/* The Active Ship Glow Layer */
.active-ship-glow-layer {
    position: absolute;
    inset: -2px;
    border-radius: 0.5rem;
    pointer-events: none;
    z-index: -1;

    border: 2px solid var(--ot-hangar-red-glow);
    box-shadow: 
        0 0 15px var(--ot-hangar-red-glow), 
        0 0 25px var(--ot-hangar-red-glow), 
        inset 0 0 12px rgba(239, 68, 68, 0.3);
    
    animation: pulse-opacity 2.5s infinite ease-in-out;
    will-change: opacity;
}


/* Intermediate Container */
#ship-card-main-content {
    flex: 1 1 auto;
    min-height: 0;
    display: flex;
    flex-direction: column;
}

/* Scrollable Grid */
.ship-card-content-wrapper {
    overflow-y: auto; 
    scrollbar-width: none;
    display: grid; 
    grid-template-columns: repeat(5, minmax(0, 1fr));
    gap: 1rem;
    padding: 1rem;
}
.ship-card-content-wrapper::-webkit-scrollbar {
    display: none; 
}

.ship-card-content-wrapper > .col-span-2,
.ship-card-content-wrapper > .col-span-3 {
    display: flex;
    flex-direction: column;
}


#ship-terminal-container.mode-hangar .ship-display-area,
#ship-terminal-container.mode-shipyard .info-panel-content {
    margin-bottom: 1rem;
}

#ship-terminal-container.mode-hangar .info-panel-hangar, 
#ship-terminal-container.mode-shipyard .info-panel-shipyard { 
    display: flex;
}


/* Hologram */
.ship-display-area { 
    /* VIRTUAL WORKBENCH: CRITICAL FIX */
    /* Removed perspective and transform-style: preserve-3d.
       This was creating a 3D stacking context for EVERY ship, causing memory explosion. */
    position: relative; 
    flex-grow: 1;
}

.ship-image-placeholder { 
    background: transparent; 
    border: 1px solid var(--ot-border-light); 
    color: var(--theme-color-primary); 
    box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
    aspect-ratio: 1 / 1;
}

.status-badge {
    position: absolute;
    bottom: -1px;
    left: 50%;
    transform: translateX(-50%) translateY(50%);
    background-color: #1a2030;
    border: 1px solid;
    padding: 3px 11px;
    border-radius: 99px;
    font-size: 0.77rem;
    font-weight: 700;
    z-index: 20; 
}

/* Hangar/Shipyard Toggle Switch */
.toggle-container {
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    padding: 3px;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
    transform: scale(0.72); 
    flex-shrink: 0; 
}
.toggle-switch {
    background-color: transparent;
    display: flex;
}
.toggle-label {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    flex-grow: 1;
    transition: all 0.3s ease;
    color: var(--ot-text-secondary);
    clip-path: polygon(0% 0%, 100% 0%, 100% 85%, 85% 100%, 0% 100%);
}
.toggle-label.shipyard {
    clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 15% 100%, 0% 85%);
}

#ship-terminal-container.mode-hangar .toggle-label.hangar,
#ship-terminal-container.mode-shipyard .toggle-label.shipyard {
    color: var(--ot-bg-dark);
    font-weight: 900;
}
#ship-terminal-container.mode-hangar .toggle-label.hangar { 
    background-color: var(--ot-hangar-red-base);
    box-shadow: 0 0 10px var(--ot-hangar-red-glow);
}
#ship-terminal-container.mode-shipyard .toggle-label.shipyard { 
    background-color: var(--ot-shipyard-blue-base);
    box-shadow: 0 0 10px var(--ot-shipyard-blue-glow);
}

/* Info Panel */
.info-panel-content { 
    display: none; 
    flex-grow: 1;
    flex-direction: column;
}
.info-panel-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.5rem; 
}
.info-panel-text {
    flex-grow: 1;
    min-width: 0;
    padding-right: 1.5rem;
}

.ship-price-display {
    margin-top: 0.5rem;
    color: var(--ot-cyan-base);
    text-shadow: 0 0 5px var(--ot-cyan-glow), 0 0 10px var(--ot-cyan-glow), 0 2px 4px rgba(0,0,0,0.8);
}

/* Parameter Bars */
.ship-param-bars {
    display: flex;
    flex-direction: column;
    /* VIRTUAL WORKBENCH: GAP ADJUSTMENT (1/11/26) */
    /* Restored to 0.2rem for better separation between the stacked bars */
    gap: 0.1rem;
    font-family: 'Roboto Mono', sans-serif;
    width: 25%;
    max-width: 85px;
    flex-shrink: 0;
    margin-left: 0.2rem;
    
    transform: scale(1.15); 
    transform-origin: top right;
}

/* VIRTUAL WORKBENCH: SVG ATOM ARCHITECTURE (1/11/26) */
/* Replaced modern layout engines with atomic graphics to prevent iOS text culling. */
.param-bar-item {
    width: 100%;
    /* VIRTUAL WORKBENCH: HEIGHT INCREASE (1/11/26) */
    /* Locked to 20px to support the vertical stack coordinates in the SVG */
    height: 20px;
    margin-bottom: 0.2rem;
}

.param-bar-svg {
    width: 100%;
    height: 100%;
    display: block;
    overflow: visible; /* Allows shadows to bleed out if needed */
}

/* Base styles for SVG content, mimicking original Orbitron/Roboto feel */
.svg-bar-label {
    font-family: 'Orbitron', sans-serif;
    /* VIRTUAL WORKBENCH: FONT SIZE INCREASE (1/11/26) */
    /* Increased to 9px for high visibility of HULL, CARGO, FUEL labels */
    font-size: 9px;
    font-weight: 700;
}

.svg-bar-text {
    font-family: 'Roboto Mono', monospace;
    font-size: 14px;
    font-weight: 700;
    /* Optimization: Static shadow for readability on GPU */
    filter: drop-shadow(0 1px 1px black);
}

/* Action Buttons - GPU Optimized Glows */
.action-button { 
    transition: transform 0.2s ease; 
    border-radius: 0.5rem; 
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.3rem 0.8rem;
    position: relative;
    overflow: visible;
    z-index: 1; 
    
    /* VIRTUAL WORKBENCH: CRITICAL FIX - Prevent Line Breaking */
    white-space: nowrap;
}

.action-button::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    z-index: -1; 
    opacity: 0;
    transition: opacity 0.3s ease;
    will-change: opacity;
    pointer-events: none;
}

.action-button:not(:disabled) {
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
.action-button:active:not(:disabled) { transform: scale(0.98); filter: brightness(1.2); }
.action-button:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(50%); }

/* Button Variations */
.action-button.is-glowing-button::before {
    background-color: var(--ot-cyan-base);
    box-shadow: 0 0 15px var(--ot-cyan-glow), 0 0 25px var(--ot-cyan-glow);
}
.action-button.is-glowing-button { animation: none; }
.action-button.is-glowing-button::before { animation: pulse-opacity 1.0s ease-in-out; }

.action-button.is-glowing-green::before {
    background-color: var(--class-b-color); 
    box-shadow: 0 0 15px var(--class-b-color), 0 0 25px var(--class-b-color);
}
.action-button.is-glowing-green { animation: none; }
.action-button.is-glowing-green::before { animation: pulse-opacity 1.0s ease-in-out; }

.action-button.is-glowing-red::before {
    background-color: var(--ot-hangar-red-glow); 
    box-shadow: 0 0 15px var(--ot-hangar-red-glow), 0 0 25px var(--ot-hangar-red-glow);
}
.action-button.is-glowing-red { animation: none; }
.action-button.is-glowing-red::before { animation: pulse-opacity 1.0s ease-in-out; }


.action-button-price {
    font-size: 1.1rem;
    color: var(--ot-cyan-base);
    text-shadow: 0 0 5px var(--ot-cyan-glow), 0 0 10px var(--ot-cyan-glow), 0 2px 4px rgba(0,0,0,0.8);
    
    /* VIRTUAL WORKBENCH: Safety measure to prevent internal wrapping */
    white-space: nowrap;
}

/* Flavor Text Styling */
.flavor-text-box {
    padding-left: 0.75rem;
    border-left: 2px solid;
    box-shadow: inset 3px 0 5px -2px rgba(0,0,0,0.5);
}

/* Inset Text Shadow */
.inset-text-shadow {
    text-shadow: 0 2px 3px rgba(0,0,0,0.6);
}

/* Pagination Dots */
#hangar-pagination-wrapper {
    position: absolute;
    bottom: 1.25rem;
    left: 0;
    right: 0;
    z-index: 10;
    flex-shrink: 0;
    overflow-x: auto;
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
    scrollbar-width: none;
    -ms-overflow-style: none;
    display: flex;
    justify-content: center;
}
#hangar-pagination-wrapper::-webkit-scrollbar {
    display: none;
}

#hangar-pagination {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    gap: 0.9775rem;
    width: max-content;
    padding: 0 1rem;
}

.pagination-dot {
    width: 1.8rem;
    height: 2.25rem;
    border-radius: 4px;
    background-color: var(--theme-color-primary, #4b5563);
    opacity: 0.3;
    transition: all 0.3s ease;
    cursor: pointer;
    pointer-events: auto; 
    display: block; 
}
.pagination-dot.active { 
    background-color: var(--theme-color-primary, #fde047);
    box-shadow: 0 0 8px var(--theme-glow-color, #fef08a);
    opacity: 1.0;
}
.pagination-dot.boarded {
    background-color: #ffffff !important;
    opacity: 1.0 !important;
    box-shadow: 0 0 8px #ffffff, 0 0 15px rgba(255, 255, 255, 0.6);
}
.pagination-dot.half {
    width: 0.9rem;
    opacity: 0.2;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .ship-card-content-wrapper {
        grid-template-columns: 1fr;
    }
    .ship-card-content-wrapper > .col-span-2,
    .ship-card-content-wrapper > .col-span-3 {
        grid-column: span 1 / span 1;
    }
    .ship-display-area {
        min-height: 180px;
    }
}

.archive-link {
    position: absolute;
    left: 100%; 
    margin-left: 0.1rem; 
    top: 50%; 
    transform: translateY(-50%);
    white-space: normal;
    text-align: center;
    line-height: 0.9;
    font-family: 'Oxanium', sans-serif;
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    color: var(--ot-cyan-base); 
    text-shadow: 0 0 5px var(--ot-cyan-glow);
    cursor: pointer;
    pointer-events: auto;
    opacity: 0.7;
    transition: all 0.2s ease;
    z-index: 20;
}
.archive-link:hover {
    opacity: 1;
    text-shadow: 0 0 8px var(--ot-cyan-glow), 0 0 12px var(--ot-cyan-glow);
}

@media (max-width: 400px) {
    .archive-link {
        margin-left: 0.1rem;
        font-size: 0.6rem;
    }
}

/* Ship Lore Modal Wrapper */
.ship-lore-modal-wrapper {
    max-height: 50vh;
    overflow-y: auto;
    padding: 0 0.5rem;
    margin-top: 0.5rem;
    scrollbar-width: thin;
    scrollbar-color: var(--ot-cyan-base) rgba(0,0,0,0.3);
}
.ship-lore-modal-wrapper::-webkit-scrollbar {
    width: 6px;
}
.ship-lore-modal-wrapper::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.3);
    border-radius: 3px;
}
.ship-lore-modal-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--ot-cyan-base);
    border-radius: 3px;
}

.ship-lore-attribute {
    text-align: center;
    color: var(--theme-color-primary, #fde047);
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    margin-bottom: 0.25rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 0 5px var(--theme-color-glow, #fef08a);
}

.ship-lore-text {
    font-family: 'Roboto Mono', monospace;
    font-size: 1.0rem;
    line-height: 1.6;
    color: var(--ot-cyan-base);
    text-align: left;
    white-space: pre-line;
}

/* Colored Text Glows */
.glow-text-z {
    text-shadow: 0 0 2px #000, 0 0 10px var(--class-z-color) !important;
}
.glow-text-o {
     text-shadow: 0 0 2px #000, 0 0 10px var(--class-o-color) !important;
}
.glow-text-s {
     text-shadow: 0 0 2px #000, 0 0 10px var(--class-s-color) !important;
}

/* UTILITY: Shrink text to fit (Added for large credit values) */
/* General shrink for Shipyard Info Panel */
.text-shrink {
    font-size: 0.85em !important;
    white-space: nowrap !important;
    letter-spacing: -0.05em;
}

/* Stronger shrink specifically for Hangar Buttons */
.text-shrink-button {
    /* VIRTUAL WORKBENCH: UPDATED - Increased from 0.75em to 0.9em for better legibility */
    font-size: 0.9em !important;
    white-space: nowrap !important;
    /* VIRTUAL WORKBENCH: UPDATED - Relaxed from -0.07em to -0.05em */
    letter-spacing: -0.05em;
}

/* MAINTENANCE NOTES FOR SVG ATOM FIX (1/11/26):
   1. Atomic Graphics: Replaced individual HTML/CSS elements with rigid SVG components to force single-layer rendering.
   2. Unbreakable Composition: Labels and values are part of the same SVG drawing, preventing the browser from independently culling text.
   3. Performance Standard: Restored aggressive content-visibility:auto as SVG rendering is highly efficient on iOS.
   4. Sub-pixel Stability: SVG viewBox coordinates provide mathematical rigidity that survives 3D carousel scaling transforms.
*/

/* [[NEW]] Animation Classes for Ship Transactions */
.is-dematerializing {
    animation: dematerialize 0.8s forwards;
}

@keyframes dematerialize {
    0% { opacity: 1; transform: scale(1); filter: brightness(1); }
    50% { opacity: 0.5; transform: scale(0.95); filter: brightness(2) blur(2px); }
    100% { opacity: 0; transform: scale(0.1); filter: brightness(5) blur(10px); }
}

.is-boarding {
    animation: board-ship 1.0s forwards;
}

@keyframes board-ship {
    0% { border-color: var(--frame-border-color); box-shadow: 0 0 0 transparent; }
    50% { border-color: var(--ot-cyan-base); box-shadow: 0 0 20px var(--ot-cyan-glow), inset 0 0 20px var(--ot-cyan-glow); }
    100% { border-color: var(--ot-green-accent); box-shadow: 0 0 30px var(--ot-green-accent), inset 0 0 30px var(--ot-green-accent); }
}

/* ================================================================================
   UPGRADE PILL "ART PASS" (ADR-008 Compliant)
   ================================================================================ */

.attribute-pill {
    /* Base Layout & Typography */
    font-family: 'Orbitron', sans-serif;
    font-size: 0.64rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    padding: 2px 8px; /* Slightly increased padding */
    border-radius: 4px;
    white-space: nowrap;
    
    /* Interaction & Performance */
    cursor: pointer;
    pointer-events: auto;
    touch-action: manipulation; /* ADR-011 */
    user-select: none;
    z-index: 20;

    /* Theming Defaults */
    color: #ffffff;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    
    /* GPU Transitions */
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.2s ease;
    will-change: transform;
}

/* Interaction States */
.attribute-pill:hover {
    filter: brightness(1.2);
    transform: scale(1.05);
    z-index: 30; /* Pop on hover */
}
.attribute-pill:active {
    transform: scale(0.95);
    filter: brightness(0.9);
}

/* --- TIER 1: COMMON (Utilitarian / Matte) --- */
.pill-tier-1 {
    background-color: #1e293b;
    border: 1px solid var(--pill-dark);
    color: var(--pill-color); /* Colored text for contrast */
    box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* --- TIER 2: UNCOMMON (Brushed Metal) --- */
.pill-tier-2 {
    background: linear-gradient(180deg, var(--pill-mid) 0%, var(--pill-dark) 100%);
    border: 1px solid var(--pill-mid);
    box-shadow: 0 1px 3px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
}

/* --- TIER 3: RARE (Glassy / Ceramic) --- */
.pill-tier-3 {
    background: linear-gradient(135deg, var(--pill-mid), var(--pill-dark));
    border: 1px solid var(--pill-color);
    box-shadow: 
        inset 0 1px 0 rgba(255,255,255,0.3), 
        0 2px 4px rgba(0,0,0,0.5);
}

/* --- TIER 4: EPIC (High-Tech / Neon) --- */
.pill-tier-4 {
    background: linear-gradient(to bottom, var(--pill-mid), #0f172a);
    border: 1px solid var(--pill-light);
    border-bottom: 2px solid var(--pill-light); /* Underlight */
    box-shadow: 
        0 2px 6px rgba(0,0,0,0.6),
        0 0 5px var(--pill-dark); /* Subtle glow */
}

/* --- TIER 5: LEGENDARY (Holographic / Prismatic) --- */
.pill-tier-5 {
    background: linear-gradient(90deg, var(--pill-dark) 0%, var(--pill-color) 50%, var(--pill-light) 100%);
    background-size: 200% 100%;
    border: 1px solid var(--pill-bright);
    box-shadow: 
        0 0 10px var(--pill-color), 
        inset 0 0 5px var(--pill-light);
    animation: pill-shimmer 3s infinite linear;
}

@keyframes pill-shimmer {
    0% { background-position: 100% 0; }
    100% { background-position: -100% 0; }
}

/* --- ALIEN / Z-CLASS (Organic / Bioluminescent) --- */
.pill-alien {
    background: radial-gradient(circle at center, var(--pill-color), var(--pill-dark));
    border: 1px solid var(--pill-light);
    box-shadow: 
        0 0 8px var(--pill-dark), 
        inset 0 0 5px var(--pill-light);
    text-shadow: 0 0 3px var(--pill-light);
    animation: pill-pulse 2s infinite ease-in-out;
}

@keyframes pill-pulse {
    0%, 100% { box-shadow: 0 0 8px var(--pill-dark), inset 0 0 5px var(--pill-light); }
    50% { box-shadow: 0 0 15px var(--pill-color), inset 0 0 10px var(--pill-light); }
}